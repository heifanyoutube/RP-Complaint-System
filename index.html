<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>RP 陳情系統 - 提交案件</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; margin: 40px; background: #f9f9f9; }
h2 { color: #333; }
input, textarea { width: 100%; margin: 6px 0; padding: 8px; }
button { padding: 8px 16px; background: #1976d2; color: white; border: none; cursor: pointer; }
</style>
</head>
<body>
<h2>📄 RP 陳情系統 - 提交案件</h2>
<form id="petitionForm">
  <label>姓名：</label><input id="name" required>
  <label>標題：</label><input id="title" required>
  <label>內容：</label><textarea id="content" rows="5" required></textarea>
  <label>上傳圖片（可選）：</label><input type="file" id="imageInput">
  <label>查詢密碼：</label><input type="password" id="password" required>
  <button type="submit">提交陳情</button>
</form>
<p id="result"></p>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js"></script>

<script>
// 🔧 Firebase 初始化
const firebaseConfig = {
  apiKey: "AIzaSyC6NqzMI3cS7DHRnmk0tH2-9Wf4-kR7fxw",
  authDomain: "rp-complaint-system.firebaseapp.com",
  projectId: "rp-complaint-system",
  storageBucket: "rp-complaint-system.firebasestorage.app",
  messagingSenderId: "995667237773",
  appId: "1:995667237773:web:2cc80732f750eaca9dfbc4",
  databaseURL: "https://rp-complaint-system-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

// 提交表單事件
document.getElementById('petitionForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const nameVal = document.getElementById('name').value.trim();
  const titleVal = document.getElementById('title').value.trim();
  const contentVal = document.getElementById('content').value.trim();
  const pwdVal = document.getElementById('password').value.trim();
  const file = document.getElementById('imageInput').files[0];
  const id = Date.now(); // 案件編號

  let imageUrl = "";
  if (file) {
    const ref = storage.ref('petitions/' + id + '-' + file.name);
    await ref.put(file);
    imageUrl = await ref.getDownloadURL();
  }

  await db.ref('petitions/' + id).set({
    id,
    name: nameVal,
    title: titleVal,
    content: contentVal,
    imageUrl,
    password: pwdVal,
    status: '待處理',
    reply: '',
    timestamp: new Date().toLocaleString('zh-TW')
  });

  document.getElementById('result').innerText = `✅ 案件已提交！請記下案件編號：${id}`;
  e.target.reset();
});
</script>
</body>
</html>
